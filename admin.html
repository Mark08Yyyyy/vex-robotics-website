<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEX机器人社团 - 内容管理系统</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'apple': ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'Segoe UI', 'Roboto', 'sans-serif'],
                    },
                    colors: {
                        'apple-blue': '#007AFF',
                        'apple-gray': {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
        }
        
        .dark body {
            background-color: #000000;
            color: #ffffff;
        }
        
        .card {
            @apply bg-white dark:bg-apple-gray-800 rounded-2xl p-6 shadow-lg border border-apple-gray-200 dark:border-apple-gray-700;
        }
        
        .btn-primary {
            @apply bg-apple-blue text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 hover:bg-blue-600 hover:scale-105 active:scale-95;
        }
        
        .btn-secondary {
            @apply bg-apple-gray-100 dark:bg-apple-gray-700 text-apple-gray-900 dark:text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 hover:bg-apple-gray-200 dark:hover:bg-apple-gray-600;
        }
        
        .input-field {
            @apply w-full px-4 py-3 border border-apple-gray-300 dark:border-apple-gray-600 rounded-lg focus:ring-2 focus:ring-apple-blue focus:border-transparent bg-white dark:bg-apple-gray-800 text-apple-gray-900 dark:text-white;
        }
        
        .sidebar-item {
            @apply flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors cursor-pointer;
        }
        
        .sidebar-item:hover {
            @apply bg-apple-gray-100 dark:bg-apple-gray-700;
        }
        
        .sidebar-item.active {
            @apply bg-apple-blue text-white;
        }
        
        .upload-area {
            @apply border-2 border-dashed border-apple-gray-300 dark:border-apple-gray-600 rounded-lg p-8 text-center transition-colors;
        }
        
        .upload-area:hover {
            @apply border-apple-blue bg-apple-blue/5;
        }
        
        .upload-area.dragover {
            @apply border-apple-blue bg-apple-blue/10;
        }
    </style>
</head>
<body class="bg-apple-gray-50 dark:bg-apple-gray-900">
    <!-- Header -->
    <header class="bg-white dark:bg-apple-gray-800 shadow-sm border-b border-apple-gray-200 dark:border-apple-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <div class="w-8 h-8 bg-apple-blue rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">VEX</span>
                    </div>
                    <h1 class="text-xl font-bold text-apple-gray-900 dark:text-white">内容管理系统</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="p-2 rounded-lg bg-apple-gray-100 dark:bg-apple-gray-700 hover:bg-apple-gray-200 dark:hover:bg-apple-gray-600 transition-colors">
                        <span id="theme-icon" class="text-xl">🌙</span>
                    </button>
                    <a href="index.html" class="btn-secondary">返回网站</a>
                    <button class="btn-primary">退出登录</button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="flex h-screen pt-16">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-apple-gray-800 shadow-sm border-r border-apple-gray-200 dark:border-apple-gray-700">
            <nav class="p-4 space-y-2">
                <div class="sidebar-item active" data-tab="dashboard">
                    <span class="text-xl">📊</span>
                    <span>仪表盘</span>
                </div>
                <div class="sidebar-item" data-tab="content">
                    <span class="text-xl">📝</span>
                    <span>内容管理</span>
                </div>
                <div class="sidebar-item" data-tab="media">
                    <span class="text-xl">🖼️</span>
                    <span>媒体库</span>
                </div>
                <div class="sidebar-item" data-tab="members">
                    <span class="text-xl">👥</span>
                    <span>成员管理</span>
                </div>
                <div class="sidebar-item" data-tab="activities">
                    <span class="text-xl">🎯</span>
                    <span>活动管理</span>
                </div>
                <div class="sidebar-item" data-tab="comments">
                    <span class="text-xl">💬</span>
                    <span>留言管理</span>
                </div>
                <div class="sidebar-item" data-tab="settings">
                    <span class="text-xl">⚙️</span>
                    <span>系统设置</span>
                </div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-6">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">仪表盘</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">欢迎使用VEX机器人社团内容管理系统</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-apple-gray-600 dark:text-apple-gray-300">总访问量</p>
                                <p class="text-2xl font-bold text-apple-gray-900 dark:text-white">12,345</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-blue-600 text-xl">👁️</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-apple-gray-600 dark:text-apple-gray-300">发布文章</p>
                                <p class="text-2xl font-bold text-apple-gray-900 dark:text-white">28</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-green-600 text-xl">📝</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-apple-gray-600 dark:text-apple-gray-300">团队成员</p>
                                <p class="text-2xl font-bold text-apple-gray-900 dark:text-white">15</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <span class="text-purple-600 text-xl">👥</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-apple-gray-600 dark:text-apple-gray-300">待审核留言</p>
                                <p class="text-2xl font-bold text-apple-gray-900 dark:text-white">7</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <span class="text-orange-600 text-xl">💬</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white mb-4">最近活动</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-apple-gray-900 dark:text-white">发布了新文章《VEX世界锦标赛回顾》</p>
                                    <p class="text-xs text-apple-gray-500">2小时前</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-apple-gray-900 dark:text-white">新成员张三加入团队</p>
                                    <p class="text-xs text-apple-gray-500">5小时前</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                <div class="flex-1">
                                    <p class="text-sm text-apple-gray-900 dark:text-white">上传了活动照片 15 张</p>
                                    <p class="text-xs text-apple-gray-500">1天前</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white mb-4">快速操作</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="btn-primary text-sm py-2" onclick="switchTab('content')">发布文章</button>
                            <button class="btn-secondary text-sm py-2" onclick="switchTab('media')">上传图片</button>
                            <button class="btn-secondary text-sm py-2" onclick="switchTab('members')">添加成员</button>
                            <button class="btn-secondary text-sm py-2" onclick="switchTab('activities')">创建活动</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content Management Tab -->
            <div id="content-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">内容管理</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">创建和管理网站内容</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="card">
                            <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white mb-4">创建新内容</h3>
                            <form class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">标题</label>
                                    <input type="text" class="input-field" placeholder="请输入文章标题">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">分类</label>
                                    <select class="input-field">
                                        <option>选择分类</option>
                                        <option>活动报道</option>
                                        <option>技术分享</option>
                                        <option>团队动态</option>
                                        <option>竞赛成果</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">摘要</label>
                                    <textarea class="input-field" rows="3" placeholder="请输入文章摘要"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">内容</label>
                                    <textarea class="input-field" rows="10" placeholder="请输入文章内容"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">标签</label>
                                    <input type="text" class="input-field" placeholder="请输入标签，用逗号分隔">
                                </div>
                                
                                <div class="flex space-x-4">
                                    <button type="button" class="btn-secondary">保存草稿</button>
                                    <button type="button" class="btn-primary">发布</button>
                                    <button type="button" class="btn-secondary">预览</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card mb-6">
                            <h3 class="text-lg font-semibold text-apple-gray-900 dark:text-white mb-4">发布设置</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">发布状态</label>
                                    <select class="input-field">
                                        <option>草稿</option>
                                        <option>已发布</option>
                                        <option>定时发布</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">发布时间</label>
                                    <input type="datetime-local" class="input-field">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">作者</label>
                                    <select class="input-field">
                                        <option>管理员</option>
                                        <option>张三</option>
                                        <option>李四</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 class="text-lg font-semibold text-apple-gray-900 dark:text-white mb-4">特色图片</h3>
                            <div class="upload-area" id="featured-image-upload">
                                <div class="text-center">
                                    <span class="text-4xl mb-2 block">📷</span>
                                    <p class="text-apple-gray-600 dark:text-apple-gray-300 mb-2">点击或拖拽上传图片</p>
                                    <p class="text-xs text-apple-gray-500">支持 JPG, PNG, GIF 格式</p>
                                </div>
                                <input type="file" class="hidden" accept="image/*" id="featured-image-input">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Media Library Tab -->
            <div id="media-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">媒体库</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">管理图片、视频和其他媒体文件</p>
                </div>
                
                <div class="card mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white">批量上传</h3>
                        <button class="btn-primary" onclick="document.getElementById('bulk-upload-input').click()">选择文件</button>
                    </div>
                    
                    <div class="upload-area" id="bulk-upload-area">
                        <div class="text-center">
                            <span class="text-6xl mb-4 block">📁</span>
                            <p class="text-xl text-apple-gray-600 dark:text-apple-gray-300 mb-2">拖拽文件到此处或点击上传</p>
                            <p class="text-sm text-apple-gray-500">支持批量上传多个文件</p>
                        </div>
                        <input type="file" class="hidden" multiple accept="image/*,video/*" id="bulk-upload-input">
                    </div>
                </div>
                
                <div class="card">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white">媒体文件</h3>
                        <div class="flex items-center space-x-2">
                            <select class="input-field w-auto">
                                <option>全部文件</option>
                                <option>图片</option>
                                <option>视频</option>
                            </select>
                            <input type="text" class="input-field w-64" placeholder="搜索文件...">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="media-grid">
                        <!-- Media items will be populated here -->
                        <div class="aspect-square bg-apple-gray-100 dark:bg-apple-gray-700 rounded-lg flex items-center justify-center cursor-pointer hover:bg-apple-gray-200 dark:hover:bg-apple-gray-600 transition-colors">
                            <span class="text-2xl">🖼️</span>
                        </div>
                        <div class="aspect-square bg-apple-gray-100 dark:bg-apple-gray-700 rounded-lg flex items-center justify-center cursor-pointer hover:bg-apple-gray-200 dark:hover:bg-apple-gray-600 transition-colors">
                            <span class="text-2xl">📷</span>
                        </div>
                        <div class="aspect-square bg-apple-gray-100 dark:bg-apple-gray-700 rounded-lg flex items-center justify-center cursor-pointer hover:bg-apple-gray-200 dark:hover:bg-apple-gray-600 transition-colors">
                            <span class="text-2xl">🎥</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Other tabs (placeholder) -->
            <div id="members-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">成员管理</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">管理团队成员信息和权限</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- 成员列表 -->
                    <div class="lg:col-span-2">
                        <div class="card">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white">团队成员</h3>
                                <button id="add-member-btn" class="btn-primary text-sm px-4 py-2">
                                    <span class="text-lg mr-1">➕</span>
                                    添加成员
                                </button>
                            </div>
                            <div id="members-list" class="space-y-4">
                                <div class="text-center text-apple-gray-500 py-8">
                                    <span class="text-4xl mb-2 block">👥</span>
                                    正在加载成员列表...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 成员表单 -->
                    <div class="lg:col-span-1">
                        <div class="card">
                            <h3 class="text-xl font-semibold text-apple-gray-900 dark:text-white mb-4" id="member-form-title">添加新成员</h3>
                            <form id="member-form" class="space-y-4">
                                <input type="hidden" id="member-id" value="">
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">头像</label>
                                    <div class="flex items-center space-x-4">
                                        <div id="member-avatar-preview" class="w-16 h-16 bg-apple-gray-200 dark:bg-apple-gray-700 rounded-full flex items-center justify-center overflow-hidden">
                                            <span class="text-apple-gray-500 text-2xl">👤</span>
                                        </div>
                                        <div class="flex-1">
                                            <input type="file" id="member-avatar" accept="image/*" class="hidden">
                                            <button type="button" onclick="document.getElementById('member-avatar').click()" class="btn-secondary text-sm px-3 py-1">
                                                选择头像
                                            </button>
                                            <p class="text-xs text-apple-gray-500 mt-1">支持 JPG、PNG 格式，建议尺寸 200x200</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">姓名 *</label>
                                    <input type="text" id="member-name" class="input-field" placeholder="请输入成员姓名" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">角色 *</label>
                                    <select id="member-role" class="input-field" required>
                                        <option value="">选择角色</option>
                                        <option value="队长">队长</option>
                                        <option value="副队长">副队长</option>
                                        <option value="编程负责人">编程负责人</option>
                                        <option value="硬件工程师">硬件工程师</option>
                                        <option value="机械设计师">机械设计师</option>
                                        <option value="UI设计师">UI设计师</option>
                                        <option value="成员">成员</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">个人简介</label>
                                    <textarea id="member-description" class="input-field" rows="3" placeholder="请输入个人简介"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">技能标签</label>
                                    <input type="text" id="member-skills" class="input-field" placeholder="用逗号分隔，如：编程,机械设计">
                                    <p class="text-xs text-apple-gray-500 mt-1">多个技能请用逗号分隔</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">邮箱</label>
                                    <input type="email" id="member-email" class="input-field" placeholder="请输入邮箱地址">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-apple-gray-700 dark:text-apple-gray-300 mb-2">电话</label>
                                    <input type="tel" id="member-phone" class="input-field" placeholder="请输入电话号码">
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button type="submit" id="save-member-btn" class="btn-primary flex-1">
                                        <span class="text-lg mr-1">💾</span>
                                        保存成员
                                    </button>
                                    <button type="button" id="cancel-member-btn" class="btn-secondary px-4" style="display: none;">
                                        取消
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="activities-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">活动管理</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">创建和管理社团活动</p>
                </div>
                <div class="card">
                    <p class="text-center text-apple-gray-500 py-8">活动管理功能开发中...</p>
                </div>
            </div>
            
            <div id="comments-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">留言管理</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">审核和管理用户留言</p>
                </div>
                <div class="card">
                    <p class="text-center text-apple-gray-500 py-8">留言管理功能开发中...</p>
                </div>
            </div>
            
            <div id="settings-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-apple-gray-900 dark:text-white mb-2">系统设置</h2>
                    <p class="text-apple-gray-600 dark:text-apple-gray-300">配置网站基本设置</p>
                </div>
                <div class="card">
                    <p class="text-center text-apple-gray-500 py-8">系统设置功能开发中...</p>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // API Configuration - Auto detect environment
        const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const API_BASE_URL = isDevelopment ? 'http://localhost:3001' : 'https://backend-9gxqdlbsn-marks-projects-bebee27c.vercel.app';
        
        // Check user authentication and permissions
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userRole = localStorage.getItem('userRole');
            const username = localStorage.getItem('username');
            
            if (!isLoggedIn || (userRole !== 'admin' && userRole !== 'member')) {
                alert('您没有权限访问此页面，请先登录！');
                window.location.href = 'login.html';
                return false;
            }
            
            // Update user info in header
            const userNameSpan = document.querySelector('h1');
            if (userNameSpan) {
                const roleText = userRole === 'admin' ? '👑 管理员' : '👥 成员';
                userNameSpan.textContent = `内容管理系统 - ${roleText} ${username}`;
            }
            
            // Hide admin-only features for members
            if (userRole === 'member') {
                // Members can't access system settings
                const settingsTab = document.querySelector('[data-tab="settings"]');
                if (settingsTab) {
                    settingsTab.style.display = 'none';
                }
                
                // Members have limited member management access
                const membersTab = document.querySelector('[data-tab="members"]');
                if (membersTab) {
                    membersTab.querySelector('span:last-child').textContent = '成员信息';
                }
            }
            
            return true;
        }
        
        // Initialize auth check
        if (!checkAuth()) {
            // Redirect handled in checkAuth function
        }
        
        // Theme Toggle
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const html = document.documentElement;
        
        const currentTheme = localStorage.getItem('theme') || 'light';
        html.classList.toggle('dark', currentTheme === 'dark');
        themeIcon.textContent = currentTheme === 'dark' ? '☀️' : '🌙';
        
        themeToggle.addEventListener('click', () => {
            const isDark = html.classList.contains('dark');
            html.classList.toggle('dark', !isDark);
            const newTheme = !isDark ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            themeIcon.textContent = newTheme === 'dark' ? '☀️' : '🌙';
        });
        
        // Tab Switching (Global function)
        window.switchTab = function(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Add active class to selected sidebar item
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }
        
        // Sidebar navigation
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', () => {
                const tabName = item.getAttribute('data-tab');
                switchTab(tabName);
            });
        });
        
        // File Upload Handlers
        function setupFileUpload(uploadAreaId, inputId) {
            const uploadArea = document.getElementById(uploadAreaId);
            const fileInput = document.getElementById(inputId);
            
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFileUpload(files);
            });
            
            fileInput.addEventListener('change', (e) => {
                const files = e.target.files;
                handleFileUpload(files);
            });
        }
        
        async function handleFileUpload(files) {
            const fileArray = Array.from(files);
            
            if (fileArray.length === 1) {
                // 单文件上传
                await uploadSingleFile(fileArray[0]);
            } else if (fileArray.length > 1) {
                // 批量上传
                await uploadMultipleFiles(fileArray);
            }
        }
        
        async function uploadSingleFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/upload/single`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`文件 "${file.name}" 上传成功！`);
                    loadMediaFiles(); // 刷新媒体文件列表
                } else {
                    alert(`上传失败: ${result.error}`);
                }
            } catch (error) {
                console.error('上传错误:', error);
                alert(`上传失败: ${error.message}`);
            }
        }
        
        async function uploadMultipleFiles(files) {
            const formData = new FormData();
            files.forEach(file => {
                formData.append('files', file);
            });
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/upload/multiple`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`成功上传 ${files.length} 个文件！`);
                    loadMediaFiles(); // 刷新媒体文件列表
                } else {
                    alert(`批量上传失败: ${result.error}`);
                }
            } catch (error) {
                console.error('批量上传错误:', error);
                alert(`批量上传失败: ${error.message}`);
            }
        }
        
        async function loadMediaFiles() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/media`);
                const result = await response.json();
                
                if (result.success) {
                    updateMediaGrid(result.media);
                }
            } catch (error) {
                console.error('加载媒体文件错误:', error);
            }
        }
        
        function updateMediaGrid(mediaFiles) {
            const mediaGrid = document.getElementById('media-grid');
            if (!mediaGrid) return;
            
            // 清空现有内容
            mediaGrid.innerHTML = '';
            
            // 添加媒体文件
            mediaFiles.forEach(file => {
                const mediaItem = document.createElement('div');
                mediaItem.className = 'aspect-square bg-apple-gray-100 dark:bg-apple-gray-700 rounded-lg flex items-center justify-center cursor-pointer hover:bg-apple-gray-200 dark:hover:bg-apple-gray-600 transition-colors relative overflow-hidden';
                
                if (file.mimetype.startsWith('image/')) {
                    mediaItem.innerHTML = `
                        <img src="${API_BASE_URL}${file.url}" alt="${file.originalName}" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 truncate">
                            ${file.originalName}
                        </div>
                    `;
                } else {
                    mediaItem.innerHTML = `
                        <span class="text-2xl">🎥</span>
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 truncate">
                            ${file.originalName}
                        </div>
                    `;
                }
                
                mediaGrid.appendChild(mediaItem);
            });
        }
        
        // Initialize file upload areas
        setupFileUpload('featured-image-upload', 'featured-image-input');
        setupFileUpload('bulk-upload-area', 'bulk-upload-input');
        
        // 成员管理功能
        let currentEditingMember = null;
        let selectedAvatarFile = null;
        
        // 头像预览功能
        function setupAvatarPreview() {
            const avatarInput = document.getElementById('member-avatar');
            const avatarPreview = document.getElementById('member-avatar-preview');
            
            if (avatarInput) {
                avatarInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        selectedAvatarFile = file;
                        
                        // 验证文件类型
                        if (!file.type.startsWith('image/')) {
                            showNotification('请选择图片文件', 'error');
                            return;
                        }
                        
                        // 验证文件大小 (2MB)
                        if (file.size > 2 * 1024 * 1024) {
                            showNotification('图片文件不能超过2MB', 'error');
                            return;
                        }
                        
                        // 显示预览
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            avatarPreview.innerHTML = `<img src="${e.target.result}" alt="预览" class="w-full h-full object-cover rounded-full">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }
        
        // 上传头像
        async function uploadAvatar(file) {
            if (!file) return null;
            
            const formData = new FormData();
            formData.append('avatar', file);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/upload/avatar`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.avatar.filename;
                } else {
                    throw new Error('头像上传失败');
                }
            } catch (error) {
                console.error('头像上传失败:', error);
                throw error;
            }
        }
        
        // 加载成员列表
        async function loadMembers() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/members`);
                const result = await response.json();
                const members = result.data || result || [];
                
                const membersList = document.getElementById('members-list');
                
                if (members.length === 0) {
                    membersList.innerHTML = `
                        <div class="text-center text-apple-gray-500 py-8">
                            <span class="text-4xl mb-2 block">👥</span>
                            暂无团队成员，点击右侧添加新成员
                        </div>
                    `;
                    return;
                }
                
                membersList.innerHTML = members.map(member => `
                    <div class="member-item bg-white dark:bg-apple-gray-800 border border-apple-gray-200 dark:border-apple-gray-700 rounded-lg p-4">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center mr-3 overflow-hidden">
                                        ${member.avatar ? 
                                            `<img src="${member.avatar}" alt="${member.name}" class="w-full h-full object-cover">` : 
                                            `<div class="w-full h-full bg-apple-blue-500 flex items-center justify-center text-white font-semibold">${member.name.charAt(0)}</div>`
                                        }
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-apple-gray-900 dark:text-white">${member.name}</h4>
                                        <p class="text-sm text-apple-blue-600 dark:text-apple-blue-400">${member.role}</p>
                                    </div>
                                </div>
                                ${member.description ? `<p class="text-sm text-apple-gray-600 dark:text-apple-gray-300 mb-2">${member.description}</p>` : ''}
                                ${member.skills && member.skills.length > 0 ? `
                                    <div class="flex flex-wrap gap-1 mb-2">
                                        ${(Array.isArray(member.skills) ? member.skills : member.skills.split(',')).map(skill => `
                                            <span class="px-2 py-1 bg-apple-gray-100 dark:bg-apple-gray-700 text-xs rounded-full text-apple-gray-700 dark:text-apple-gray-300">
                                                ${typeof skill === 'string' ? skill.trim() : skill}
                                            </span>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                <div class="text-xs text-apple-gray-500 space-y-1">
                                    ${member.email ? `<div>📧 ${member.email}</div>` : ''}
                                    ${member.phone ? `<div>📱 ${member.phone}</div>` : ''}
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editMember(${member.id})" class="text-apple-blue-600 hover:text-apple-blue-800 text-sm px-2 py-1 rounded">
                                    ✏️ 编辑
                                </button>
                                <button onclick="deleteMember(${member.id}, '${member.name}')" class="text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded">
                                    🗑️ 删除
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('加载成员列表失败:', error);
                document.getElementById('members-list').innerHTML = `
                    <div class="text-center text-red-500 py-8">
                        <span class="text-4xl mb-2 block">❌</span>
                        加载成员列表失败，请检查网络连接
                    </div>
                `;
            }
        }
        
        // 保存成员
        async function saveMember(memberData) {
            try {
                const isEditing = currentEditingMember !== null;
                
                // 如果有选择新头像，先上传头像
                if (selectedAvatarFile) {
                    try {
                        const avatarFilename = await uploadAvatar(selectedAvatarFile);
                        memberData.avatar = `${API_BASE_URL}/uploads/avatars/${avatarFilename}`;
                    } catch (error) {
                        showNotification('头像上传失败，但成员信息将继续保存', 'warning');
                    }
                }
                
                const url = isEditing ? `${API_BASE_URL}/api/members/${currentEditingMember}` : `${API_BASE_URL}/api/members`;
                const method = isEditing ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(memberData)
                });
                
                if (response.ok) {
                    showNotification(isEditing ? '成员信息更新成功！' : '新成员添加成功！', 'success');
                    resetMemberForm();
                    loadMembers();
                } else {
                    throw new Error('保存失败');
                }
            } catch (error) {
                console.error('保存成员失败:', error);
                showNotification('保存失败，请重试', 'error');
            }
        }
        
        // 编辑成员
        async function editMember(memberId) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/members/${memberId}`);
                const result = await response.json();
                const member = result.data || result;
                
                currentEditingMember = memberId;
                selectedAvatarFile = null;
                
                // 填充表单
                document.getElementById('member-id').value = member.id;
                document.getElementById('member-name').value = member.name;
                document.getElementById('member-role').value = member.role;
                document.getElementById('member-description').value = member.description || '';
                document.getElementById('member-skills').value = member.skills || '';
                document.getElementById('member-email').value = member.email || '';
                document.getElementById('member-phone').value = member.phone || '';
                
                // 显示现有头像
                const avatarPreview = document.getElementById('member-avatar-preview');
                if (member.avatar) {
                    avatarPreview.innerHTML = `<img src="${member.avatar}" alt="${member.name}" class="w-full h-full object-cover rounded-full">`;
                } else {
                    avatarPreview.innerHTML = '<span class="text-apple-gray-500 text-2xl">👤</span>';
                }
                
                // 更新表单标题和按钮
                document.getElementById('member-form-title').textContent = '编辑成员信息';
                document.getElementById('save-member-btn').innerHTML = '<span class="text-lg mr-1">💾</span>更新成员';
                document.getElementById('cancel-member-btn').style.display = 'block';
                
            } catch (error) {
                console.error('加载成员信息失败:', error);
                showNotification('加载成员信息失败', 'error');
            }
        }
        
        // 删除成员
        async function deleteMember(memberId, memberName) {
            if (!confirm(`确定要删除成员 "${memberName}" 吗？此操作不可撤销。`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/members/${memberId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showNotification('成员删除成功！', 'success');
                    loadMembers();
                } else {
                    throw new Error('删除失败');
                }
            } catch (error) {
                console.error('删除成员失败:', error);
                showNotification('删除失败，请重试', 'error');
            }
        }
        
        // 重置成员表单
        function resetMemberForm() {
            currentEditingMember = null;
            selectedAvatarFile = null;
            document.getElementById('member-form').reset();
            document.getElementById('member-id').value = '';
            document.getElementById('member-form-title').textContent = '添加新成员';
            document.getElementById('save-member-btn').innerHTML = '<span class="text-lg mr-1">💾</span>保存成员';
            document.getElementById('cancel-member-btn').style.display = 'none';
            
            // 重置头像预览
            const avatarPreview = document.getElementById('member-avatar-preview');
            if (avatarPreview) {
                avatarPreview.innerHTML = '<span class="text-apple-gray-500 text-2xl">👤</span>';
            }
        }
        
        // 显示通知
        function showNotification(message, type = 'info') {
            // 简单的alert实现，后续可以改为更美观的通知组件
            alert(message);
        }
        
        // Content management functions
        async function saveContent(status = 'published') {
            const title = document.querySelector('input[placeholder="请输入文章标题"]').value;
            const category = document.querySelector('select').value;
            const summary = document.querySelector('textarea[placeholder="请输入文章摘要"]').value;
            const content = document.querySelector('textarea[placeholder="请输入文章内容"]').value;
            const tags = document.querySelector('input[placeholder="请输入标签，用逗号分隔"]').value;
            
            if (!title.trim()) {
                alert('请输入文章标题！');
                return;
            }
            
            if (!content.trim()) {
                alert('请输入文章内容！');
                return;
            }
            
            if (category === '选择分类') {
                alert('请选择文章分类！');
                return;
            }
            
            const contentData = {
                title: title.trim(),
                category,
                summary: summary.trim(),
                content: content.trim(),
                tags: tags.trim(),
                status
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/content`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(contentData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(result.message);
                    if (status === 'published') {
                        // 清空表单
                        clearContentForm();
                    }
                } else {
                    alert(`操作失败: ${result.error}`);
                }
            } catch (error) {
                console.error('内容保存错误:', error);
                alert(`操作失败: ${error.message}`);
            }
        }
        
        function clearContentForm() {
            document.querySelector('input[placeholder="请输入文章标题"]').value = '';
            document.querySelector('select').selectedIndex = 0;
            document.querySelector('textarea[placeholder="请输入文章摘要"]').value = '';
            document.querySelector('textarea[placeholder="请输入文章内容"]').value = '';
            document.querySelector('input[placeholder="请输入标签，用逗号分隔"]').value = '';
        }
        
        // Form handlers
        document.addEventListener('DOMContentLoaded', () => {
            // Save draft button
            document.querySelector('button[type="button"]:nth-of-type(1)').addEventListener('click', () => {
                saveContent('draft');
            });
            
            // Publish button
            document.querySelector('button[type="button"]:nth-of-type(2)').addEventListener('click', () => {
                saveContent('published');
            });
            
            // Preview button
            document.querySelector('button[type="button"]:nth-of-type(3)').addEventListener('click', () => {
                alert('预览功能开发中...');
            });
            
            // Load media files on page load
            loadMediaFiles();
            
            // Load members on page load
             loadMembers();
             
             // 设置头像预览功能
             setupAvatarPreview();
             
             // 成员表单事件监听
            const memberForm = document.getElementById('member-form');
            if (memberForm) {
                memberForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const memberData = {
                        name: document.getElementById('member-name').value.trim(),
                        role: document.getElementById('member-role').value,
                        description: document.getElementById('member-description').value.trim(),
                        skills: document.getElementById('member-skills').value.trim(),
                        email: document.getElementById('member-email').value.trim(),
                        phone: document.getElementById('member-phone').value.trim()
                    };
                    
                    if (!memberData.name || !memberData.role) {
                        showNotification('请填写必填字段（姓名和角色）', 'error');
                        return;
                    }
                    
                    saveMember(memberData);
                });
            }
            
            // 添加成员按钮
            const addMemberBtn = document.getElementById('add-member-btn');
            if (addMemberBtn) {
                addMemberBtn.addEventListener('click', function() {
                    resetMemberForm();
                });
            }
            
            // 取消编辑按钮
            const cancelMemberBtn = document.getElementById('cancel-member-btn');
            if (cancelMemberBtn) {
                cancelMemberBtn.addEventListener('click', function() {
                    resetMemberForm();
                });
            }
        });
        
        // Make functions global for onclick handlers
        window.editMember = editMember;
        window.deleteMember = deleteMember;
    </script>
</body>
</html>